<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>认识webpack | 欣-技术笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="用于记录所学知识">
    
    <link rel="preload" href="/assets/css/0.styles.b4933ffa.css" as="style"><link rel="preload" href="/assets/js/app.2b276f17.js" as="script"><link rel="preload" href="/assets/js/6.4619fce8.js" as="script"><link rel="preload" href="/assets/js/2.ea162f4d.js" as="script"><link rel="preload" href="/assets/js/35.422344af.js" as="script"><link rel="prefetch" href="/assets/js/10.deaf5fff.js"><link rel="prefetch" href="/assets/js/11.c07d4c79.js"><link rel="prefetch" href="/assets/js/12.e9b05fc5.js"><link rel="prefetch" href="/assets/js/13.38505a82.js"><link rel="prefetch" href="/assets/js/14.289b3a5c.js"><link rel="prefetch" href="/assets/js/15.e792572f.js"><link rel="prefetch" href="/assets/js/16.b054e12f.js"><link rel="prefetch" href="/assets/js/17.620dbdb9.js"><link rel="prefetch" href="/assets/js/18.2481fca2.js"><link rel="prefetch" href="/assets/js/19.112e71a6.js"><link rel="prefetch" href="/assets/js/20.ab74850c.js"><link rel="prefetch" href="/assets/js/21.f9bbe3cf.js"><link rel="prefetch" href="/assets/js/22.5485580e.js"><link rel="prefetch" href="/assets/js/23.091504bc.js"><link rel="prefetch" href="/assets/js/24.b0342d78.js"><link rel="prefetch" href="/assets/js/25.39de772b.js"><link rel="prefetch" href="/assets/js/26.00df7261.js"><link rel="prefetch" href="/assets/js/27.bbbd8dd2.js"><link rel="prefetch" href="/assets/js/28.c040e6a7.js"><link rel="prefetch" href="/assets/js/29.53e4225b.js"><link rel="prefetch" href="/assets/js/3.70aa92ba.js"><link rel="prefetch" href="/assets/js/30.fabe1845.js"><link rel="prefetch" href="/assets/js/31.9ca9ad9a.js"><link rel="prefetch" href="/assets/js/32.710b4971.js"><link rel="prefetch" href="/assets/js/33.5ca343df.js"><link rel="prefetch" href="/assets/js/34.c9b1153e.js"><link rel="prefetch" href="/assets/js/36.5095878b.js"><link rel="prefetch" href="/assets/js/37.93a613e7.js"><link rel="prefetch" href="/assets/js/38.0b75e46f.js"><link rel="prefetch" href="/assets/js/39.a7cd6dd2.js"><link rel="prefetch" href="/assets/js/4.8453ad77.js"><link rel="prefetch" href="/assets/js/40.136df7b8.js"><link rel="prefetch" href="/assets/js/41.d8498bf2.js"><link rel="prefetch" href="/assets/js/42.a07f8f0c.js"><link rel="prefetch" href="/assets/js/43.5dcdac04.js"><link rel="prefetch" href="/assets/js/44.e419af20.js"><link rel="prefetch" href="/assets/js/45.45e667f5.js"><link rel="prefetch" href="/assets/js/46.686f6180.js"><link rel="prefetch" href="/assets/js/47.fa687447.js"><link rel="prefetch" href="/assets/js/48.c5319695.js"><link rel="prefetch" href="/assets/js/49.9643f458.js"><link rel="prefetch" href="/assets/js/5.08ad096a.js"><link rel="prefetch" href="/assets/js/50.bdc2004a.js"><link rel="prefetch" href="/assets/js/51.a0e01b62.js"><link rel="prefetch" href="/assets/js/52.85028a9f.js"><link rel="prefetch" href="/assets/js/53.ff974719.js"><link rel="prefetch" href="/assets/js/54.a987a001.js"><link rel="prefetch" href="/assets/js/55.26501f71.js"><link rel="prefetch" href="/assets/js/56.66979d08.js"><link rel="prefetch" href="/assets/js/57.58fa5900.js"><link rel="prefetch" href="/assets/js/58.1054672b.js"><link rel="prefetch" href="/assets/js/59.4758f0eb.js"><link rel="prefetch" href="/assets/js/60.5622108c.js"><link rel="prefetch" href="/assets/js/7.acbb4317.js"><link rel="prefetch" href="/assets/js/8.a09a5268.js"><link rel="prefetch" href="/assets/js/9.606ac6a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4933ffa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">欣-技术笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端的基础内容" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端的基础内容" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/frontend/basis/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/basis/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/basis/javascript/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端的进阶内容" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端的进阶内容" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/frontend/advanced/es6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/advanced/git/" class="nav-link">
  Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端的框架内容" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端的框架内容" class="mobile-dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/frontend/frame/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/frame/vue3/" class="nav-link router-link-active">
  Vue3
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zhangxin1996" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端的基础内容" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端的基础内容" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/frontend/basis/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/basis/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/basis/javascript/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端的进阶内容" class="dropdown-title"><span class="title">前端进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端的进阶内容" class="mobile-dropdown-title"><span class="title">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/frontend/advanced/es6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/advanced/git/" class="nav-link">
  Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端的框架内容" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端的框架内容" class="mobile-dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/frontend/frame/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/frame/vue3/" class="nav-link router-link-active">
  Vue3
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zhangxin1996" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue3</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/frontend/frame/vue3/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/pages/frontend/frame/vue3/01_邂逅Vue3开发.html" class="sidebar-link">邂逅Vue3开发</a></li><li><a href="/pages/frontend/frame/vue3/02_vue3模板语法.html" class="sidebar-link">vue3模板语法</a></li><li><a href="/pages/frontend/frame/vue3/03_vue3的Options-API.html" class="sidebar-link">vue3的Options-API</a></li><li><a href="/pages/frontend/frame/vue3/04_组件化开发模式.html" class="sidebar-link">组件化开发模式</a></li><li><a href="/pages/frontend/frame/vue3/05_webpack学习.html" class="active sidebar-link">webpack学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#认识webpack" class="sidebar-link">认识webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#前端的发展" class="sidebar-link">前端的发展</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#什么是webpack" class="sidebar-link">什么是webpack</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#vue项目中哪些文件需要webpack" class="sidebar-link">Vue项目中哪些文件需要webpack</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack的使用" class="sidebar-link">webpack的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack的使用前提" class="sidebar-link">webpack的使用前提</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack安装" class="sidebar-link">webpack安装</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#在项目中使用webpack" class="sidebar-link">在项目中使用webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#使用全局webpack打包" class="sidebar-link">使用全局webpack打包</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#使用局部webpack打包" class="sidebar-link">使用局部webpack打包</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack配置文件" class="sidebar-link">webpack配置文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack对css的处理" class="sidebar-link">webpack对css的处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack依赖图" class="sidebar-link">webpack依赖图</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#css-loader的使用" class="sidebar-link">css-loader的使用</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#style-loader的使用" class="sidebar-link">style-loader的使用</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#处理less文件" class="sidebar-link">处理less文件</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#less-loader的使用" class="sidebar-link">less-loader的使用</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#认识postcss工具" class="sidebar-link">认识PostCSS工具</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack对资源的处理" class="sidebar-link">webpack对资源的处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#加载图片案例准备" class="sidebar-link">加载图片案例准备</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#file-loader" class="sidebar-link">file-loader</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#url-loader" class="sidebar-link">url-loader</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#asset-module-type" class="sidebar-link">asset module type</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#加载字体文件" class="sidebar-link">加载字体文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#认识plugin" class="sidebar-link">认识Plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#cleanwebpackplugin" class="sidebar-link">CleanWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#htmlwebpackplugin" class="sidebar-link">HtmlWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#defineplugin" class="sidebar-link">DefinePlugin</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#copywebpackplugin" class="sidebar-link">CopyWebpackPlugin</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#mode和devtool配置" class="sidebar-link">Mode和Devtool配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#babel" class="sidebar-link">babel</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#为什么需要babel" class="sidebar-link">为什么需要babel</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#babel在命令行使用" class="sidebar-link">babel在命令行使用</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#插件的使用" class="sidebar-link">插件的使用</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#babel的底层原理" class="sidebar-link">babel的底层原理</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#在webpack中使用babel" class="sidebar-link">在webpack中使用babel</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack对vue的处理" class="sidebar-link">webpack对vue的处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#js文件中写vue代码并打包" class="sidebar-link">js文件中写vue代码并打包</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#vue的不同版本选择" class="sidebar-link">vue的不同版本选择</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#编写-vue文件对其打包" class="sidebar-link">编写.vue文件对其打包</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#全局标识的配置" class="sidebar-link">全局标识的配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#devserver" class="sidebar-link">devServer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#为什么搭建本地服务器" class="sidebar-link">为什么搭建本地服务器</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack的watch-mode" class="sidebar-link">webpack的watch mode</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack-dev-server" class="sidebar-link">webpack-dev-server</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#resolve模块解析" class="sidebar-link">resolve模块解析</a></li><li class="sidebar-sub-header"><a href="/pages/frontend/frame/vue3/05_webpack学习.html#webpack配置区分开发环境和生产环境" class="sidebar-link">webpack配置区分开发环境和生产环境</a></li></ul></li><li><a href="/pages/frontend/frame/vue3/06_Vue-CLI.html" class="sidebar-link">Vue-CLI</a></li><li><a href="/pages/frontend/frame/vue3/07_Vite.html" class="sidebar-link">Vite</a></li><li><a href="/pages/frontend/frame/vue3/08_组件化开发.html" class="sidebar-link">组件化开发</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="认识webpack"><a href="#认识webpack" class="header-anchor">#</a> 认识webpack</h2> <h3 id="前端的发展"><a href="#前端的发展" class="header-anchor">#</a> 前端的发展</h3> <p>事实上随着前端的快速发展，目前前端的开发已经变的越来越复杂了：</p> <ul><li>开发过程中需要通过<strong>模块化的方式</strong>来开发；</li> <li>使用一些<strong>高级的特性来加快开发效率或者安全性</strong>，比如通过ES6+、TypeScript开发脚本逻辑，通过Sass、Less等方式来编写css样式；</li> <li>开发工程中，希望<strong>实时的监测代码的变化并反映到浏览器上</strong>，提高开发效率；</li> <li>开发完项目后，<strong>对代码进行压缩、合并以及其他相关的优化</strong>；</li> <li>等等……</li></ul> <p>但目前前端开发来说，并不需要考虑这些问题，原因是目前前端开发我们通常直接使用三大框架来开发，这三大框架的创建过程我们都是借助于脚手架（CLI）。事实上Vue CLI、React CLI、Angular CLI都是基于<strong>webpack</strong>帮助我们支持模块化、less、TypeScript、打包优化等。</p> <img src="/frontend/frame/vue3/05_learn-webpack/01_三大框架基于webpack.png" alt="三大框架基于webpack" class="medium"> <h3 id="什么是webpack"><a href="#什么是webpack" class="header-anchor">#</a> 什么是webpack</h3> <p>官方的解释是：webpack is a <strong>static</strong> <strong>module</strong> <strong>bundler</strong> for <strong>modern</strong> JavaScript applications.</p> <p>翻译过来是：webpack 是一个用于现代 JavaScript 应用程序的 静态模块打包工具。</p> <p>我们对上面的解释进行拆解：</p> <ul><li>打包bundler：webpack是一个打包工具，可以帮助我们对代码进行打包；</li> <li>静态的static：最终将代码打包成最终的静态资源（之后部署到静态服务器）；</li> <li>模块化module：webpack默认支持各种模块化开发，ES Module、CommonJS、AMD、CMD等；</li> <li>现代的medern：前面说个，正是因为现在前端的发展面临各种问题，才催生了webpack的出现和发展；</li></ul> <p>官方效果图：
<img src="/frontend/frame/vue3/05_learn-webpack/02_webpack官方效果图.png" alt="webpack官方效果图" class="medium"></p> <h3 id="vue项目中哪些文件需要webpack"><a href="#vue项目中哪些文件需要webpack" class="header-anchor">#</a> Vue项目中哪些文件需要webpack</h3> <p>JavaScript的打包：</p> <ul><li>将ES6语法转化为ES5语法；</li> <li>将TypeScript转化为JavaScript；</li></ul> <p>CSS的处理：</p> <ul><li>CSS文件模块的加载和处理；</li> <li>Less、Sass等预处理器的处理；</li></ul> <p>资源文件img、font：</p> <ul><li>图片文件的加载；</li> <li>字体文件的加载；</li></ul> <p>HTML资源的处理：</p> <ul><li>打包HTML资源文件；</li></ul> <p>处理vue项目中SFC文件——.vue文件</p> <h2 id="webpack的使用"><a href="#webpack的使用" class="header-anchor">#</a> webpack的使用</h2> <h3 id="webpack的使用前提"><a href="#webpack的使用前提" class="header-anchor">#</a> webpack的使用前提</h3> <p>这是<a href="https://webpack.docschina.org/" target="_blank" rel="noopener noreferrer">webpack的官方中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>因为webpack的运行是依赖<code>Node环境</code>的，所以电脑必须安装Node环境。打开<a href="https://nodejs.org/" target="_blank" rel="noopener noreferrer">Node官方网站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>进行安装Node.js同时会安装NPM。</p> <h3 id="webpack安装"><a href="#webpack安装" class="header-anchor">#</a> webpack安装</h3> <p>webpack的安装目前是分为两个：webpack、webpack-cli。</p> <p>安装：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 全局安装</span>
npm install webpack webpack<span class="token operator">-</span>cli <span class="token operator">-</span>g

<span class="token comment">// 局部安装</span>
npm install webpack webpack<span class="token operator">-</span>cli <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>它们之间的关系是：</p> <ul><li>在项目中执行 webpack 命令，其实执行的是 node_modules 下的 .bing 目录下的 webpack；</li> <li>而 webpack 在执行时是依赖 webpack-cli 的，如果没有安装 webpack-cli 的话就会报错；</li> <li>而 webpack-cli 中代码执行时，才是真正利用 webpack 进行编译和打包过程的；</li> <li>所以在安装 webpack 时，同时要安装 webpack-cli（第三方脚手架事实上是没有安装 webpack-cli 的，而是类似于自己的 vue-service-cli 的东西）；</li></ul> <p>webpack 和 webpack-cli 图示：</p> <img src="/frontend/frame/vue3/05_learn-webpack/03_webpack和webpack-cli图示.png" alt="webpack和webpack-cli图示" class="medium"> <h2 id="在项目中使用webpack"><a href="#在项目中使用webpack" class="header-anchor">#</a> 在项目中使用webpack</h2> <p>根据下面的目录结构创建js和html文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>├─index<span class="token punctuation">.</span>html
├─src
<span class="token operator">|</span>  ├─index<span class="token punctuation">.</span>js
<span class="token operator">|</span>  ├─js
<span class="token operator">|</span>  <span class="token operator">|</span> ├─format<span class="token punctuation">.</span>js
<span class="token operator">|</span>  <span class="token operator">|</span> └math<span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol><li>创建math.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用ES Module导出</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>创建format.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用CommonJS导出</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">priceFormat</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;¥&quot;</span> <span class="token operator">+</span> price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>在index.js中导入math.js的sum函数和format.js的priceFormat函数</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>sum<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./js/math&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>priceFormat<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./js/format&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">priceFormat</span><span class="token punctuation">(</span><span class="token number">3.99</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>在index.html中通过script标签引入index.js</li></ol> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./src/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这样直接在浏览器打开控制台是会报错的。</p> <h3 id="使用全局webpack打包"><a href="#使用全局webpack打包" class="header-anchor">#</a> 使用全局webpack打包</h3> <p>前面我们全局安装了webpack，所以可以通过webpack进行打包，之后运行<strong>打包之后</strong>的代码。在目录下直接执行<code>webpack命令</code>即可。</p> <img src="/frontend/frame/vue3/05_learn-webpack/04_webpack默认打包-webpack命令.png" alt="webpack默认打包-webpack命令" class="medium"> <p>之后目录下生成一个<strong>dist文件夹</strong>，里面存放着一个<strong>main.js的文件</strong>，这就是打包之后的文件。</p> <img src="/frontend/frame/vue3/05_learn-webpack/05_webpack默认打包-webpack命令生成的文件.png" alt="webpack默认打包-webpack命令生成的文件" class="medium"> <p>这个文件中的代码被压缩和丑化了，可我们发现代码中还存在ES6的语法比如箭头函数，这是因为默认情况下，webpack并不清楚我们打包后的文件，是否需要转化为ES5之前的语法，后续需要通过babel来进行转化和设置。</p> <p>接下来我们就可以在<strong>index.html</strong>中引入dist目录下main.js了。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./dist/main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 输出：
15
¥3.99
--&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>我们发现这样可以正常打包，是因为在执行webpack命令时，webpack会查找当前目录下的<code>src/index.js</code>文件作为入口，所以如果当前目录中没有存在<code>src/index.js</code>文件就会报错。</p> <p>当然，我们也可以通过命令行配置来自己指定入口和和出口：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npx webpack <span class="token operator">--</span>entry <span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>js <span class="token operator">--</span>output<span class="token operator">-</span>path <span class="token punctuation">.</span><span class="token operator">/</span>build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果所有项目都使用全局的webpack进行打包会有问题的，因为不同项目所依赖webpack的版本是不同的，会有兼容性问题。所以在真实项目中会在当前项目再安装一个局部的webpack。</p> <h3 id="使用局部webpack打包"><a href="#使用局部webpack打包" class="header-anchor">#</a> 使用局部webpack打包</h3> <p>下面演示创建局部webpack：</p> <ol><li>第一步：创建package.json文件，用于管理项目的信息、库依赖等</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm init
<span class="token comment">// 简便写法</span>
npm init <span class="token operator">-</span>y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>第二步：安装局部webpack</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>mpm install webpack webpack-cli --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>使用局部的webpack</li></ol> <ul><li>方案一：在命令行输入命令进行打包</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span><span class="token punctuation">.</span>bin<span class="token operator">/</span>webpack
<span class="token comment">// 或者</span>
npx webpack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>npm工具提供了npx，当执行<code>npx webpack</code>命令时，优先在<code>./node_modules/.bin</code>查找webpack命令。</p> <ul><li>方案二：在package.json中创建<code>scripts脚本</code>，执行脚本打包即可</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>执行命令：npm run build。在脚本执行命令会自动到<code>./node_modules/.bin</code>查找webpack命令。</p> <h3 id="webpack配置文件"><a href="#webpack配置文件" class="header-anchor">#</a> webpack配置文件</h3> <p>如果想在package.json中的scripts脚本配置指定出口和入口：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --entry ./src/index.js --output-path ./dist&quot;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>通常情况下，webpack需要打包的项目是非常复杂的，并且我们需要一系列的配置来满足要求，全部放到scripts脚本是不现实的。</p> <p>我们可以在根目录下创建一个<code>webpack.config.js</code>文件，来作为webpack的配置文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 导出配置文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>继续执行<code>npm run build</code>命令，依然可以正常打包。</p> <p>默认配置文件的名字是webpack.config.js，如果我们将其改成wk.config.js，可以通过--config来指定对应的配置文件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>webpack --config wk.config.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是每次这样执行命令会非常繁琐，所以可以在package.json中新增一个新的脚本：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config wk.config.json&quot;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>之后执行<code>npm run duild</code>命令来打包即可。</p> <h2 id="webpack对css的处理"><a href="#webpack对css的处理" class="header-anchor">#</a> webpack对css的处理</h2> <p>根据下面的目录结构创建element.js和style.css文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>├─src
<span class="token operator">|</span>  ├─css
<span class="token operator">|</span>  <span class="token operator">|</span> ├─style<span class="token punctuation">.</span>css
<span class="token operator">|</span>  ├─js
<span class="token operator">|</span>  <span class="token operator">|</span> └element<span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li>element.js中通过JavaScript代码创建div元素并为其设置类及内容。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> divEle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
divEle<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">;</span>
divEle<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;你好啊，李银河！&quot;</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>divEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>style.css中书写样式</li></ol> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.title</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="webpack依赖图"><a href="#webpack依赖图" class="header-anchor">#</a> webpack依赖图</h3> <p>如果直接执行<code>npm run build</code>命令，界面中是没有div元素的。</p> <p>事实上webpack在处理应用程序时，它会根据命令或者配置文件找到入口文件。从入口文件开始，会生成一个依赖关系图，这个依赖关系图会包含应用程序中所有需要的模块（比如js文件、css文件、图片、字体等）。然后遍历图结构，打包一个个模块（根据文件的不同使用不同的loader来解析）。</p> <p>在webpack.config.js文件中，规定了入口文件是./src/index.js，index.js文件中导入了math.js和format.js模块，所以会最终打包。如果想将element.js打包就要导入模块。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ./src/js/main.js</span>
<span class="token keyword">import</span> <span class="token string">&quot;./js/element&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>将style.css样式文件导入：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ./src/css/element.js</span>
<span class="token keyword">import</span> <span class="token string">&quot;../css/style.css&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="css-loader的使用"><a href="#css-loader的使用" class="header-anchor">#</a> css-loader的使用</h3> <p>模块也导入了，接下来执行<code>npm run build</code>命令进行打包，发现报错了。</p> <img src="/frontend/frame/vue3/05_learn-webpack/06_没有合适的loader来解析css文件.png" alt="没有合适的loader来解析css文件" class="medium"> <p>上面的错误信息告诉我们需要了一个loader来加载css文件，那什么是loader呢？</p> <p>loader 用于对模块的源代码进行转换。我们可以将css文件也看成是一个模块，我们是通过import来加载这个模块的。在加载这个模块时，webpack其实并不知道如何对其进行加载，所以我们必须制定对应的loader来完成此功能。</p> <p>对于当前需要加载css文件来说，我们需要一个可以读取css文件的loader。这个loader就是<strong>css-loader</strong>。</p> <p>css-loader的安装：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install css-loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用css-loader来加载css文件由三种方式：</p> <ul><li>内联方式；</li></ul> <p>在import引用样式文件路径的前面加上使用的loader，并用!分割。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;css-loader!../css/style.css&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>内联方式使用的较少，因为不方便管理。</p> <ul><li>CLI方式（webpack5中不再使用）；</li></ul> <p>在wepack5的文档中已经没有了<code>--module-bind</code>，在实际应用中也比较少使用，因为不方便管理。</p> <ul><li>配置文件方式；</li></ul> <p>配置文件方式是在webpack.config.js文件中写配置信息，<code>module.rules</code>中允许配置许多个loader（因为也需要使用其他的loader来解析其他的文件），这种方式可以更好的表示loader的配置，也方便后期的维护，同时也让你对各个loader有一个全局的概念。</p> <p>module.rules的配置如下：</p> <p>rules属性对应的值是一个数组，数组中存放的一个个的Rule，每一个Rule是一个对象，对象中可以设置多个属性：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>test属性：用于对资源进行匹配，通常设置正则表达式；
loader属性：是Rule.use[{loader}]的简写；
use属性：对应的值是一个数组，[UseEntry]；
  * 当UseEntry为一个对象，可以设置一些属性：
    * loader：必须有一个loader属性，对应的值是一个字符串；
    * options：可选的属性，值是一个字符串或者对象，值会被传入到loader中；
    * query：目前已经使用options替代；
  * 当UseEntry为字符串时，如`use: [&quot;css-loader&quot;]`，是loader属性的简写方式`use:[{loader: &quot;css-loader&quot;}] `
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>配置代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 导出配置文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 写法一</span>
        <span class="token comment">// loader: &quot;css-loader&quot;,</span>

        <span class="token comment">// 写法二：当有多个loader时使用这种方法</span>
        <span class="token comment">// use: [&quot;css-loader&quot;],</span>

        <span class="token comment">// 写法三：需要额外的可选属性，完整写法</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="style-loader的使用"><a href="#style-loader的使用" class="header-anchor">#</a> style-loader的使用</h3> <p>我们通过css-loader来加载css文件，但css在代码中并没有生效。原因是：css-loader只负责将.css文件进行解析，并不会将解析后的css插入到页面中。如果想要将解析后的css通过style标签的形式插入到页面中，需要使用<code>style-loader</code>。</p> <p>安装style-loader：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install style-loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在配置文件中配置style-loader，要注意loader执行顺序时从右向左（或者从下向上），所以要将style-loader写到css-loader的前面。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>重新执行<code>npm run build</code>命令，可以发现打包的css已经生效了。是通过页内样式的方式添加进来的。</p> <h3 id="处理less文件"><a href="#处理less文件" class="header-anchor">#</a> 处理less文件</h3> <p>在开发中，我们为了开发效率的提高，可能使用less、sass、stylus等预处理器来编写css样式。怎么能让其转化为普通的css呢？</p> <p>在这里我们以less样式为示例，在<code>./src/css/</code>目录下创建title.less：</p> <div class="language-less line-numbers-mode"><pre class="language-less"><code><span class="token variable">@fontSize<span class="token punctuation">:</span></span> 30px<span class="token punctuation">;</span>
<span class="token variable">@textDecoration<span class="token punctuation">:</span></span> underline<span class="token punctuation">;</span>

<span class="token selector">.title</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token variable">@fontSize</span><span class="token punctuation">;</span>
  <span class="token property">text-decoration</span><span class="token punctuation">:</span> <span class="token variable">@textDecoration</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>我们可以使用less工具来完成它的编译转换，安装less工具：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install less -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npx lessc ./src/css/title.less ./src/css/title.css
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="less-loader的使用"><a href="#less-loader的使用" class="header-anchor">#</a> less-loader的使用</h3> <p>但在项目中有大量的css，手动转化肯定不行，这时使用<code>less-loader</code>来自动使用less工具转化less为css。</p> <p>安装：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install less-loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在webpack.config.js配置less-loader：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在<code>./src/js/element.js</code>文件中引入less文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;../css/title.less&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行<code>npm run build</code>命令，less就可以自动转换成css，并且页面也会生效了。</p> <h3 id="认识postcss工具"><a href="#认识postcss工具" class="header-anchor">#</a> 认识PostCSS工具</h3> <p>PostCSS 是一个用 JavaScript 工具和插件转换 CSS 代码的工具。这个工具可以帮助我们进行CSS的转化和适配，比如自动添加浏览器前缀、css样式的重置、支持最新的css语法等。除了工具以外还要借助于PostCSS对应的插件。</p> <p>使用PostCSS主要有两个步骤：</p> <ul><li>步骤一：查找PostCSS在构建工具中的拓展，比如webpack中的postcss-loader；</li> <li>步骤二：选择你需要添加的PostCSS相关的插件；</li></ul> <h4 id="命令行使用postcss工具及安装autoprefixer插件"><a href="#命令行使用postcss工具及安装autoprefixer插件" class="header-anchor">#</a> 命令行使用PostCSS工具及安装autoprefixer插件</h4> <p>当然我们可以不使用构建工具，直接在命令行使用PostCSS，需要安装postcss和postcss-cli：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install postcss postcss-cli -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们编写一个需要添加前缀的css文件，在<code>./src/css/</code>目录下创建test.css：</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.title</span> <span class="token punctuation">{</span>
  <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>因为需要添加前缀，所以需要安装插件antoprefixer，</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install autoprefixer -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之后在命令行使用PostCSS工具并指定使用的插件antoprefixer对css进行转化，</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npx postcss --use autoprefixer -o ./src/css/test.css ./src/css/test.css
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>转化之后的css文件样式如下：</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.title</span> <span class="token punctuation">{</span>
  <span class="token property">-webkit-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
     <span class="token property">-moz-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token property">-ms-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
          <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="使用postcss-loader"><a href="#使用postcss-loader" class="header-anchor">#</a> 使用postcss-loader</h4> <p>真实开发必然不会使用命令行工具来对css进行处理，借助webpack构建工具使用postcss-loader来处理。</p> <p>安装postcss-loader：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install postcss-loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改webpack.config.js中加载css的loader，因为postcss需要有对应的插件才会起作用，所以需配置plugin。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        postcssOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
          plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;autoprefixer&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><img src="/frontend/frame/vue3/05_learn-webpack/07_使用postcss-loader及插件autoprefixer的页面效果.png" alt="07_使用postcss-loader及插件autoprefixer的页面效果" class="medium"> <p>也可将这些配置信息抽离到单独的文件中进行管理，我们在根目录下创建postcss.config.js文件，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;autoprefixer&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>webpack.config.js文件就可以这样写了：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="postcss-preset-env插件"><a href="#postcss-preset-env插件" class="header-anchor">#</a> postcss-preset-env插件</h4> <p>事实上在配置postcss-loader时，我们配置插件并不需要使用autoprefixer，而是使用另一个插件postcss-preset-env。</p> <p>它也是一个postcss的插件，它可以帮助我们将一些现代的css特性，转换成大多数浏览器可以认识的css，并且会根据目标浏览器或者运行时环境添加所需的polyfill。也包括会自动帮助我们添加autoprefixer（所以相当于已经内置了autoprefixer）。</p> <p>首先需要安装postcss-preset-env插件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install postcss-preset-env -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之后就可以直接修改掉之前的autoprefixer插件了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;postcss-preset-env&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>我们在使用某些postcss插件时，也可以直接传入字符串：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;postcss-preset-env&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="webpack对资源的处理"><a href="#webpack对资源的处理" class="header-anchor">#</a> webpack对资源的处理</h2> <h3 id="加载图片案例准备"><a href="#加载图片案例准备" class="header-anchor">#</a> 加载图片案例准备</h3> <p>为了演示在项目中可以加载图片，我们需要在项目中使用图片，比较常见使用图片的方式是两种：</p> <ul><li>第一种：img元素设置src属性；</li> <li>第二种：其他元素（比如div元素），设置background-image的css属性；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ./src/js/element.js</span>

<span class="token keyword">import</span> <span class="token string">&quot;../css/image.css&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 加载图片资源</span>
<span class="token comment">// 2.1 创建img元素设置src</span>
<span class="token keyword">const</span> imgEle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
imgEle<span class="token punctuation">.</span>src <span class="token operator">=</span> zznhImage<span class="token punctuation">;</span>
imgEle<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">&quot;100px&quot;</span><span class="token punctuation">;</span>
imgEle<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">&quot;100px&quot;</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>imgEle<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2.2 设置背景图片，创建div元素设置class属性</span>
<span class="token keyword">const</span> bgDivEle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bgDivEle<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;image-bg&quot;</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>bgDivEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/* ./src/css/image.css */</span>

<span class="token selector">.image-bg</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">&quot;../img/nhlt.jpg&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token property">background-size</span><span class="token punctuation">:</span> contain<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这时通过<code>npm run build</code>命令打包会报错。</p> <img src="/frontend/frame/vue3/05_learn-webpack/08_加载图片资源报错需要合适的loader.png" alt="加载图片资源报错需要合适的loader" class="medium"> <h3 id="file-loader"><a href="#file-loader" class="header-anchor">#</a> file-loader</h3> <p>要处理jpg、png等格式的图片资源，需要使用对应的loader：<strong>file-loader</strong>。</p> <p>安装file-loader：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install file-loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在webpack.config.js中配置处理文件的Rule：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              esModule<span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'javascript/auto'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><img src="/frontend/frame/vue3/05_learn-webpack/09_使用file-loader打包.png" alt="使用file-loader打包" class="medium"> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>当在 webpack 5 中使用旧的 assets loader（如 file-loader/url-loader/raw-loader 等）和 asset 模块时，你可能想停止当前 asset 模块的处理，并再次启动处理，这可能会导致 asset 重复，你可以通过将 asset 模块的类型设置为 'javascript/auto' 来解决。</p></div> <div class="custom-block danger"><p class="custom-block-title">注意</p> <p>在<code>npm run build</code>命令，图像标签的 src 被构建为&lt;img src=&quot;[object Module]&quot;&gt;。这是因为file-loader版本过高导致的，esModule选项已在4.3.0版本的文件加载器中引入，而在5.0.0版本中，默认情况下已将其设置为true。</p> <p>一种解决方案是：安装4.3.0以下版本的file-loader；</p> <p>另一种解决方案是：使用4.3.0以上版本的file-loader,需设置esModule: false；</p></div> <p>有时候我们处理后的文件名称想按照一定的规则进行显示，比如保留原有文件名及扩展名，同时为了防止重复在原有文件名后包含一个hash值。</p> <p>这时可以使用PlaceHolders来完成，webpack给我们提供了大量的PlaceHolders来显示不同的内容，<a href="https://webpack.docschina.org/loaders/file-loader/#placeholders" target="_blank" rel="noopener noreferrer">点击文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来查阅更多自己需要的PlaceHolders。</p> <p>这里介绍几个常用的PlaceHolders：</p> <ul><li><code>[ext]</code>：目标文件或资源的文件扩展名；</li> <li><code>[name]</code>：文件或资源的 basename；</li> <li><code>[hash]</code>：指定生成文件内容哈希值的哈希方法；</li> <li><code>[contentHash]</code>：在file-loader中和<code>[hash]</code>结果是一致的（在webpack的一些其他地方不一样，后面会讲到）；</li> <li><code>[hash:&lt;length&gt;]</code>：截取hash的长度，默认32个字符；</li> <li><code>[path]</code>：文件相对于 webpack/config context 的资源路径；</li></ul> <p>我们可以按照如下的格式编写，设置文件的名称及所在目录，这也是Vue的写法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              name<span class="token operator">:</span> <span class="token string">&quot;img/[name]_[hash:6].[ext]&quot;</span><span class="token punctuation">,</span>
              esModule<span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'javascript/auto'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>前面的配置我们通过/img已经设置了文件夹，当然也可以通过<code>outputPath</code>来设置输出的文件夹：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              name<span class="token operator">:</span> <span class="token string">&quot;[name]_[hash:6].[ext]&quot;</span><span class="token punctuation">,</span>
              outputPath<span class="token operator">:</span> <span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span>
              esModule<span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'javascript/auto'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>下面通过<code>npm run build</code>命令打包，查看dist文件夹。</p> <img src="/frontend/frame/vue3/05_learn-webpack/10_file-loader设置图片存放路径及文件名.png" alt="file-loader设置图片存放路径及文件名" class="medium"> <h3 id="url-loader"><a href="#url-loader" class="header-anchor">#</a> url-loader</h3> <p>url-loader 功能类似于 file-loader, 但是在文件大小（单位为字节）低于指定的限制时，可以转换为 base64 URI。</p> <p>安装 url-loader：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install url-loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>webpack.config.js配置Rule：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              name<span class="token operator">:</span> <span class="token string">&quot;img/[name]_[hash:6].[ext]&quot;</span><span class="token punctuation">,</span>
              esModule<span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'javascript/auto'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>打包后浏览器中图片可以正常展示，但是dist文件夹中不会看到图片，原因是默认情况下url-loader会将所有图片转化成base64编码。</p> <img src="/frontend/frame/vue3/05_learn-webpack/11_url-loader默认打包.png" alt="url-loader默认打包" class="medium"> <p>但在开发中我们往往是小的图片进行转化，大的图片直接使用图片。因为小的图片转化成base64之后可以和页面一起请求下来，浏览器就可以解析从而减少了不必要请求过程。而大的图片如果也进行转换，反而会影响页面的请求速度。</p> <p>url-loader有一个options属性<code>limit</code>，可以用于转换时的限制。我们有两张图片大小分别是：38kb和295kb，我们在webpack.config.js中设置一个限额将38kb的图片进行base64编码，而295kb图片不会。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              limit<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">,</span>
              name<span class="token operator">:</span> <span class="token string">&quot;img/[name]_[hash:6].[ext]&quot;</span><span class="token punctuation">,</span>
              esModule<span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'javascript/auto'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>打包后dist文件夹：</p> <img src="/frontend/frame/vue3/05_learn-webpack/12_url-loader配置options属性limit后的dist文件夹.png" alt="url-loader配置options属性limit后的dist文件夹" class="medium"> <h3 id="asset-module-type"><a href="#asset-module-type" class="header-anchor">#</a> asset module type</h3> <h4 id="认识asset-module-type"><a href="#认识asset-module-type" class="header-anchor">#</a> 认识asset module type</h4> <p>资源模块（asset module）是一种模块类型，它允许使用资源文件（字体、图标等）而无需配置额外的loader。</p> <p>我们当前使用webpack版本是webpack5，而在webpack5之前，通常使用：file-loader、url-loader、raw-loader。</p> <p>从webpack5开始，资源模块类型（asset module type），通过添加4中新的模块类型，来替换所有这些loader:</p> <ul><li>asset/resource：发送一个单独的文件并导出URL。之前通常使用 file-loader 实现；</li> <li>asset/inline：导出一个资源的 data URI。之前通常使用 url-loader 实现；</li> <li>asset/souce：导出资源的源代码。之前通常使用 raw-loader 实现；</li> <li>asset：在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 url-loader，并且配置资源体积限制实现。</li></ul> <h4 id="asset-module-type的使用"><a href="#asset-module-type的使用" class="header-anchor">#</a> asset module type的使用</h4> <ol><li>类似file-loader的效果</li></ol> <p>加载图片时可以使用如下Rule：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">&quot;asset/resource&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>想自定义文件的输出路径和文件名称，有两种方式：</p> <ul><li>修改output，添加assetModuleFilename属性：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span><span class="token punctuation">,</span>
    assetModuleFilename<span class="token operator">:</span> <span class="token string">&quot;img/[name]_[hash:6][ext]&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&quot;asset/resource&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>在Rule中，添加一个generator属性，并设置filename；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&quot;asset/resource&quot;</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">&quot;img/[name]_[hash:6][ext]&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="2"><li>类似url-loader的limit效果</li></ol> <p>将type修改为asset，添加parser属性并且制定dataUrlCondition的条件，添加maxSize属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&quot;asset&quot;</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">&quot;img/[name]_[hash:6][ext]&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        parser<span class="token operator">:</span> <span class="token punctuation">{</span>
          dataUrlCondition<span class="token operator">:</span> <span class="token punctuation">{</span>
            maxSize<span class="token operator">:</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="加载字体文件"><a href="#加载字体文件" class="header-anchor">#</a> 加载字体文件</h3> <p>如果我们需要使用某些特殊的字体或者字体图标，那么我们会引用很多的字体文件，这些字体文件的处理也是一样的。</p> <p>将字体文件放到<code>./src/font</code>目录下，在<code>，./src/js/element.js</code>文件内创建i元素用于显示图标：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 引入字体图标的css文件  </span>
<span class="token keyword">import</span> <span class="token string">&quot;../font/iconfont.css&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 创建i元素</span>
<span class="token keyword">const</span> iEle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;i&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iEle<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;iconfont icon-ashbin&quot;</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>我们直接使用webpack5的资源模块类型来处理字体文件，在webpack.config.js中书写Rule：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|woff2?)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">&quot;asset/resource&quot;</span><span class="token punctuation">,</span>
  generator<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;font/[name]_[hash:6][ext]&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>打包后dist文件夹：</p> <img src="/frontend/frame/vue3/05_learn-webpack/13_使用资源模块类型处理字体文件.png" alt="使用资源模块类型处理字体文件" class="medium"> <h2 id="认识plugin"><a href="#认识plugin" class="header-anchor">#</a> 认识Plugin</h2> <p>Webpack的另外一个核心是Plugin，官方对Plugin的描述：</p> <p>loader 用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。包括：打包优化，资源管理，注入环境变量。</p> <h3 id="cleanwebpackplugin"><a href="#cleanwebpackplugin" class="header-anchor">#</a> CleanWebpackPlugin</h3> <p>前面我们演示案例的过程中，每次修改了配置，重新打包时，都需要手动删除dist文件夹。现在我们可以借助CleanWebpckPlugin插件来完成。</p> <p>首先安装插件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install clean-webpack-plugin -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之后在webpack.config.js配置插件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其他省略</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="htmlwebpackplugin"><a href="#htmlwebpackplugin" class="header-anchor">#</a> HtmlWebpackPlugin</h3> <p>另外还有一个不太规范的地方是，我们的HTML文件是编写在根目录下的，而最终打包的dist文件夹中是没有index.html文件的。之后对项目进行部署时，必须需要有对应的入口文件index.html，所以需要对index.html进行打包处理。</p> <p>对HTML进行打包处理可以使用另外一个插件：HtmlWebpackPlugin。</p> <p>安装插件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install html-webpack-plugin -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之后在webpack.config.js配置插件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其他省略</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>之后在进行<code>npm run build</code>命令打包后，dist文件夹会自动生成index.html文件。该文件中会自动添加打包的bundle.js文件。</p> <img src="/frontend/frame/vue3/05_learn-webpack/14_使用HtmlWebpackPlugin插件打包后dist文件夹下html文件.png" alt="使用HtmlWebpackPlugin插件打包后dist文件夹下html文件" class="medium"> <p>原理是：在html-webpack-plugin插件的源码中，有一个default_index.ejs模块。默认情况下index.html文件根据ejs的一个模板来生成的。</p> <p>如果我们想在自己的模块中加入一些比较特别的内容：</p> <ul><li>比如添加&lt;noscript&gt;标签，在用户的JavaScript被关闭时，给予响应提示；</li> <li>比如开发vue项目时，需要一个可以挂载后续组件的根标签&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</li></ul> <p>我们需要自定义一个属于自己的index.html模块，此文件放到项目目录下public文件夹内，之后以此为模板进行整个项目打包，项目目录下的index.html文件就可以删除了：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width,initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;%= BASE_URL %&gt;favicon.ico<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>&lt;%= htmlWebpackPlugin.options.title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>noscript</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>We're sorry but &lt;%= htmlWebpackPlugin.options.title %&gt; doesn't work properly without JavaScript enabled. Please enable it to continue.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>noscript</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- built files will be auto injected --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>上面的代码中，会有一些类似这样的语法&lt;% 变量 %&gt;，这个是EJS模块填充数据的方式。</p> <p>接下来在配置HtmlWebpackPlugin时，可以添加如下配置：</p> <ul><li>template属性：用来指定要使用模块的路径；</li> <li>title属性：在进行htmlWebpackPlugin.options.title读取时，就会读到该信息；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其他省略</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;webpack资源案例&quot;</span>，
      template<span class="token operator">:</span> <span class="token string">&quot;./public/index.html&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="defineplugin"><a href="#defineplugin" class="header-anchor">#</a> DefinePlugin</h3> <img src="/frontend/frame/vue3/05_learn-webpack/15_自定义index.html模板编译报错.png" alt="15_自定义index.html模板编译报错" class="medium"> <p>编译报错是因为在编译template模块时，有一个BASE_URL的常量我们没有定义过，&lt;link rel=&quot;icon&quot; href=&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;&gt;，所以会出现没有定义的错误。</p> <p>这时我们可以使用DefinePlugin插件，这个插件是webpack内置的插件，不需要单独安装，作用是：允许在编译时创建配置的全局常量。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> DefinePlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其他省略</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token constant">BASE_URL</span><span class="token operator">:</span> <span class="token string">&quot;'./'&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="copywebpackplugin"><a href="#copywebpackplugin" class="header-anchor">#</a> CopyWebpackPlugin</h3> <p>在vue打包过程中，如果我们有些文件放到public目录下，那么这个目录的文件会被复制到dist文件夹中。这个复制功能可以使用<code>CopyWebpackPlugin</code>插件来完成。</p> <p>安装CopyWebpackPlugin插件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install copy-webpack-plugin -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>接下来配置CopyWebpackPlugin，规则在patterns中设置：</p> <ul><li>from：设置从哪一个源中开始复制；</li> <li>to：复制到的位置，可以省略，会默认复制到打包目录下；</li> <li>globOptions：设置一些额外的选项，其中可以编写需要省略的文件：
<ul><li>index.html：不需要复制，通过HtmlWebpackPlugin插件完成了index.html的生成；</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> CopyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;copy-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其他省略</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CopyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      patterns<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span> 
          to<span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>
          globOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
            ignore<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/index.html&quot;</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="mode和devtool配置"><a href="#mode和devtool配置" class="header-anchor">#</a> Mode和Devtool配置</h3> <p>Mode配置选项可以告知webpack使用哪种响应模式的内置优化，默认值是production，有none|development|production这几个可选值。下面是几个可选值的详细讲解：</p> <img src="/frontend/frame/vue3/05_learn-webpack/16_mode的可选值有哪些.png" alt="mode的可选值有哪些" class="medium"> <p>一般开发阶段设置development，准备打包上线时设置production。</p> <p>Devtool有很多，这里设置source-map，为了建立js映射文件，方便之后调试代码和错误位置。</p> <p>应用场景：</p> <p>当在element.js中打印<code>content.length</code>，其实content是没有定义的，打包后浏览器肯定会报错的。但错误的位置不利于查找。</p> <img src="/frontend/frame/vue3/05_learn-webpack/17_未定义变量报错.png" alt="未定义变量报错" class="medium"> <p>我们可以在webpack.config.js中设置mode和devtool：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其他代码省略</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>之后打包会生成一个bundle.js的source-map文件，这个文件是bundle.js的映射文件，之后在打开浏览器就能准确定位错误的位置。</p> <img src="/frontend/frame/vue3/05_learn-webpack/18_设置mode和devtool后准确定位报错位置.png" alt="设置mode和devtool后准确定位报错位置" class="medium"> <h2 id="babel"><a href="#babel" class="header-anchor">#</a> babel</h2> <h3 id="为什么需要babel"><a href="#为什么需要babel" class="header-anchor">#</a> 为什么需要babel</h3> <p>在开发中我们很少去接触babel，但是babel对前端来说，目前是不可缺少的一部分。</p> <p>开发中，我们想使用ES6+语法，想使用TypeScript，开发React项目都是离不开babel的。所以学习babel对于理解代码从编写到线上的转化过程有至关重要的作用。</p> <p><a href="https://babeljs.io/docs/en/" target="_blank" rel="noopener noreferrer">官方<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>对babel的解释是：</p> <p>Babel 是一个工具链，主要用于在当前和旧浏览器或环境中将 ECMAScript 2015+ 代码转换为向后兼容的 JavaScript 版本。</p> <p>babel主要做的事情：转化语法和源代码转换。</p> <h3 id="babel在命令行使用"><a href="#babel在命令行使用" class="header-anchor">#</a> babel在命令行使用</h3> <p>babel本身作为<strong>一个独立的工具</strong>（和PostCSS一样），不和webpack等构建工具配置来单独使用也可以。</p> <p>尝试在命令行使用babel，需要安装如下库：</p> <ul><li>@babel/core：babel的核心代码，必须安装；</li> <li>@babel/cli：babel带有一个内置的 CLI，可用于从命令行编译文件；</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install @babel/core @babel/cli -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用babel来处理源代码：</p> <ul><li>src：源文件的目录，也可以是文件；</li> <li>--out-dir：输出的文件夹，dist；</li> <li>--out-file：输出到文件，test-compiled.js；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npx babel src <span class="token operator">--</span>out<span class="token operator">-</span>file dist
<span class="token comment">// 或者</span>
npx babel src <span class="token operator">--</span>out<span class="token operator">-</span>file test<span class="token operator">-</span>compiled<span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们编写一个包含ES6语法的js文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// test.js</span>

<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;cba&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nba&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>下面在命令行输入如下命令对源代码进行转换：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npx babel test<span class="token punctuation">.</span>js <span class="token operator">--</span>out<span class="token operator">-</span>file test<span class="token operator">-</span>compiled<span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们发现转化后的test-compiled.js文件依然是ES6的语法，因为在使用babel的时候如果想把某些语法进行转化必须使用对应的插件。</p> <img src="/frontend/frame/vue3/05_learn-webpack/19_babel对源文件进行转换.png" alt="babel对源文件进行转换" class="medium"> <h3 id="插件的使用"><a href="#插件的使用" class="header-anchor">#</a> 插件的使用</h3> <p>我们需要转换箭头函数，就使用箭头函数转换的相关插件，安装插件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>arrow<span class="token operator">-</span>functions <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>命令行输入命令：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npx babel test<span class="token punctuation">.</span>js <span class="token operator">--</span>out<span class="token operator">-</span>file test<span class="token operator">-</span>compiled<span class="token punctuation">.</span>js <span class="token operator">--</span>plugins<span class="token operator">=</span>@babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>arrow<span class="token operator">-</span>functions
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以看到箭函数已经转换了，但const并没有转换为var。这是因为<code>plugin-transform-arrow-functions</code>，并没有这样的功能。</p> <img src="/frontend/frame/vue3/05_learn-webpack/20_使用了针对箭头函数的插件.png" alt="使用了针对箭头函数的插件" class="medium"> <p>针对const转换需要使用<code>plugin-transform-block-scoping</code>来完成，安装插件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>block<span class="token operator">-</span>scoping <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>命令行输入命令，需要两个插件来完成：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npx babel test<span class="token punctuation">.</span>js <span class="token operator">--</span>out<span class="token operator">-</span>file test<span class="token operator">-</span>compiled<span class="token punctuation">.</span>js <span class="token operator">--</span>plugins<span class="token operator">=</span>@babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>arrow<span class="token operator">-</span>functions<span class="token punctuation">,</span>@babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>block<span class="token operator">-</span>scoping
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但如果转换的内容过多，一个个设置是比较麻烦的，我们可以使用babel提供的预设（preset），预设也就是将多个常用的ES6插件集合到一起了，后面再讲预设代表什么含义。</p> <p>安装@babel/preset-env预设：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install @babel/preset-env -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行如下命令就可以对箭头函数和const关键字进行转换了：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npx babel test.js --out-file test-compiled.js --presets=@babel/preset-env
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>而且预设还标识使用严格模式：</p> <img src="/frontend/frame/vue3/05_learn-webpack/21_使用babel提供的预设转化后结果.png" alt="使用babel提供的预设转化后结果" class="medium"> <h3 id="babel的底层原理"><a href="#babel的底层原理" class="header-anchor">#</a> babel的底层原理</h3> <p>babel是如何将一段代码（ES6、TypeS）转换为另一段代码（ES5）,事实上从一种源代码（原生语言）转换成另一种源代码（目标语言）这一工作就是编译器。</p> <p>我们可以将babel看成是一个编译器，babel编译器的作用就是将我们的源代码转换成浏览器可以直接识别的另一段源代码。</p> <p>babel也拥有编译器的工作流程：</p> <ul><li>解析阶段（Parsing）</li> <li>转换阶段（Transformation）</li> <li>生成阶段（Code Generation）</li></ul> <p>未完待续……</p> <h3 id="在webpack中使用babel"><a href="#在webpack中使用babel" class="header-anchor">#</a> 在webpack中使用babel</h3> <p>在实际开发中，我们通常在构建工具比如webpack中通过配置babel来对其进行转换。那么就需要去安装相关依赖了，如果之前已经安装了<code>@babel/core</code>就不需要再次安装了。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install babel-loader @babel/core -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们可以设置一个规则，在加载js文件的时候使用babel，而且必须使用插件才能生效。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>

<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.m?js$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;@babel/plugin-transform-arrow-functions&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;@babel/plugin-transform-block-scoping&quot;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>如果我们一个个去装使用插件，那么需要手动来管理大量的babel插件，我们可以直接给webpack提供一个preset，webpack会根据我们的预设来加载对应的插件列表，并且传递给babel。</p> <p>常见的预设有三个：</p> <ul><li>env;</li> <li>react;</li> <li>TypeScript;</li></ul> <p>安装preset-env：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install @babel/preset-env -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之后设置规则：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>

<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.m?js$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        presets<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>也可像之前PostCSS一样，将babel的配置信息当道一个独立的文件中，babel给我们提供了两种配置文件的编写：</p> <ul><li>一种：babel.config.json（或者.js、.cjs、.mjs后缀名都可）文件，；</li> <li>另一种：babelrc.json（或者.babelrc、.js、.cjs、.mjs后缀名都可）文件；</li></ul> <p>它们之间的区别是：目前很多项目都采用了多包管理的方式，而.babelrc.json是早期使用较多的配置方式，对于配置Monorepos项目是比较麻烦的。babel.config.json（babel7）可以直接作用于Monorepos项目的子包，更加推荐。</p> <p>我们在根目录新建<code>babel.config.js</code>文件，配置信息写入：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  presets<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>webpack.config.js</code>中规则修改如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.m?js$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="webpack对vue的处理"><a href="#webpack对vue的处理" class="header-anchor">#</a> webpack对vue的处理</h2> <h3 id="js文件中写vue代码并打包"><a href="#js文件中写vue代码并打包" class="header-anchor">#</a> js文件中写vue代码并打包</h3> <p>我们学习Vue应该包含Vue相关的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// vue代码</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token string">&quot;&lt;h2&gt;Hello World&lt;/h2&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;你好啊，李银河&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>当打包后浏览器界面上是没有模板内容显示的，而且命令行也没有报错信息，接着我们查看控制台发现有警告信息：</p> <img src="/frontend/frame/vue3/05_learn-webpack/22_vue代码控制台警告信息.png" alt="vue代码控制台警告信息" class="medium"> <p>翻译是：**组件提供了模板选项，但此 Vue 版本不支持运行时编译。**意思是说，我们当前Vue代码中有模板template，而引用的Vue版本是没办法解析模板template的。</p> <p>我们查看<code>node_modules</code>中Vue有多个版本，在dist文件夹下：</p> <img src="/frontend/frame/vue3/05_learn-webpack/23_node_modules中vue多个版本.png" alt="node_modules中vue多个版本" class="medium"> <h3 id="vue的不同版本选择"><a href="#vue的不同版本选择" class="header-anchor">#</a> vue的不同版本选择</h3> <p>统一说明下：</p> <ul><li>下面讲解不同的版本内容，括号中是可选的参数；</li> <li>包含.runtime的文件说明：此文件是不包含compiler的，不能编译template模板；</li> <li>包含.prod的文件说明：此文件是丑化过（压缩过）的，在生产阶段使用的；</li></ul> <p>下面讲解不同的版本：</p> <ul><li>vue(.runtime).global(.prod).js:
<ul><li>此版本是之前通过CDN引入或者下载至本地的Vue版本；</li> <li>在浏览器中通过<code>&amp;lt;script src=&quot;…&quot;&amp;gt;</code>直接使用；</li> <li>会暴露一个全局的Vue来使用；</li></ul></li> <li>vue(.runtime).esm-browser(.prod).js:
<ul><li>此版本用于通过原生ES Module导入使用（在浏览器中通过<code>&amp;lt;script type=&quot;module&quot; src=&quot;…&quot;&amp;gt;</code>来使用）</li></ul></li> <li>vue(.runtime).esm-bundler.js:
<ul><li>此版本用于webpack、rollup、parcel等构建工具使用；</li> <li>在构建工具中默认使用的是<code>vue.runtime.esm-bundler.js</code>，此版本是不能解析模板template，如果需要解析模板template，就要手动指定<code>vue.esm-bundler.js</code>;</li></ul></li> <li>vue.cjs(.prod).js:
<ul><li>此版本是服务器端渲染使用；</li> <li>通过require()在Node.js中使用；</li></ul></li></ul> <p>了解vue的不同版本后，对引入vue包进行修改，之后在浏览器就可以显示template模板中的内容了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue/dist/vue.esm-bundler&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>对于什么时候使用**runtime+compiler(运行时+编译器)<strong>什么时候使用</strong>runtime only(仅运行时)**肯定有疑惑？下面通过在Vue开发过程中编写DOM元素的方式来分情况讨论。</p> <p>在Vue开发过程中我们有三种方式来编写DOM元素：</p> <ul><li>方式一：template模板的方式（也是之前经常使用的方式）；</li> <li>方式二：render函数的方式，使用h函数来编写渲染的内容；</li> <li>方式三：通过.vue文件中template来编写模板；</li></ul> <p>它们是如何处理的：</p> <ul><li>方式二是通过h函数直接返回一个虚拟节点，也就是VNode节点。</li> <li>方式一和方式三中template都需要有特定的方式来对其进行解析：
<ul><li>方式三.vue文件中的template可以通过<code>vue-loader</code>对其进行编译处理；</li> <li>方式一中的template必须<strong>通过源码中一部分代码</strong>来进行编译处理；</li></ul></li></ul> <p>所以，Vue在让我们选择版本的时分为<strong>运行时+编译器</strong>和<strong>仅运行时</strong>：</p> <ul><li><strong>运行时+编译器</strong>包含了对template模板的编译代码，更加完整包体积也更大一些；</li> <li><strong>仅运行时</strong>没有包含对template模板的编译代码，包体积也相对更小一些；</li></ul> <h3 id="编写-vue文件对其打包"><a href="#编写-vue文件对其打包" class="header-anchor">#</a> 编写.vue文件对其打包</h3> <p>在前面提到，真实开发大多数情况下都是使用SFC（Single-file Components(单文件组件)）。</p> <p>在VSCode对SFC的支持：</p> <ul><li>插件一：Vetur，从Vue2开发就一直在使用的VSCode支持Vue的插件；</li> <li>插件二：Volar，官方推荐的插件（后续会基于Volar开发官方的VSCode插件）；</li></ul> <p>我们编写一个App.vue文件，在createApp导入使用：</p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

&lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;你好啊，李银河&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">h2</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">p</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue/dist/vue.esm-bundler&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./vue/App.vue&quot;</span><span class="token punctuation">;</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们对代码打包会报错，我们需要一个合适的loader来处理.vue文件。</p> <img src="/frontend/frame/vue3/05_learn-webpack/25_需要一个合适的loader处理.vue文件.png" alt="需要一个合适的loader处理.vue文件" class="medium"> <p>安装vue-loader：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install vue-loader@next -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在webpack.config.js中进行配置规则：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">&quot;vue-loader&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>进行以上配置后打包还是会报错，是因为必须添加<code>@vue/compiler-sfc插件</code>来对template进行解析，vue-loader是依赖@vue/compiler-sfc插件对template进行解析的，</p> <img src="/frontend/frame/vue3/05_learn-webpack/26_vue-loader需要插件解析template.png" alt="vue-loader需要插件解析template" class="medium"> <p>安装@vue/compiler-sfc插件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install @vue/compiler-sfc -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置对应的插件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> VueLoaderPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vue-loader/dist/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>重新打包即支持App.vue的写法，我们也可以编写其他的.vue文件来作为App的子组件。</p> <h3 id="全局标识的配置"><a href="#全局标识的配置" class="header-anchor">#</a> 全局标识的配置</h3> <p>我们会发现浏览器的控制台还有另外一个警告：</p> <img src="/frontend/frame/vue3/05_learn-webpack/24_需要全局标识的配置.png" alt="需要全局标识的配置" class="medium"> <p>我们点击<a href="https://github.com/vuejs/vue-next/tree/master/packages/vue#bundler-build-feature-flags" target="_blank" rel="noopener noreferrer">链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>进入，在GitHub上的文档中我们可以找到说明：</p> <img src="/frontend/frame/vue3/05_learn-webpack/27_全局标识匹配说明.png" alt="全局标识匹配说明" class="medium"> <p>在esm-bundler 3.0.0-rc.c版本时，需要设置两个特性的标识：</p> <ul><li>一个是Vue的Options API，是对Vue2做适配的。默认是true，
<ul><li>在Vue源码中是有对Options API做解析的，但我们在代码中全部使用Vue3的Composition API就不需要对Options API做解析，应该在源码中删除。</li></ul></li> <li>一个是Vue在Production模式下是否支持devtools工具。默认是false。</li></ul> <p>虽然都有默认值，但是强烈建议手动对它们进行配置。以便在最终捆绑包中进行适当的摇树。也就是对不需要的代码在源代码中删减，最终的包体积会减少。</p> <p>在webpack的DefinePlugin中设置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 其他代码</span>
      __VUE_OPTIONS_API__<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      __VUE_PROD_DEVTOOLS__<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>之后打包浏览器控制台就没有警告信息了。</p> <h2 id="devserver"><a href="#devserver" class="header-anchor">#</a> devServer</h2> <h3 id="为什么搭建本地服务器"><a href="#为什么搭建本地服务器" class="header-anchor">#</a> 为什么搭建本地服务器</h3> <p>在开发源代码时，为了运行需要两个操作：</p> <ul><li>通过<code>npm run build</code>命令，对源打码进行编译；</li> <li>通过VSCode中<strong>live server插件</strong>或者直接打开浏览器的方式，打开index.html代码查看效果；</li></ul> <p>但这个过程频繁操作非常影响开发效率，我们希望做到，当文件中内容发生变化的时候，可以自动完成编译和展示。</p> <p>我们先来说为了完成自动编译，webpack提供了几种可选方式：</p> <ul><li>webpack的watch mode；</li> <li>webpack-dev-serve(常用)；</li> <li>webpack-dev-middleware(少见);</li></ul> <h3 id="webpack的watch-mode"><a href="#webpack的watch-mode" class="header-anchor">#</a> webpack的watch mode</h3> <p>webpack给我们提供了<strong>watch模式</strong>，在该模式下，webpack依赖图中的所有文件，只要有一个文件发生更新，那么代码将被重新编译。不需要我们收定执行 npm run build 指令了。</p> <p>开启watch模式有两种方式，选其一都可实现：</p> <ul><li>在webpack.config.js配置文件，在导出的配置中，添加配置<code>watch: true</code>;</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 省略其他代码</span>
  watch<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>在package.json文件的 scripts 中新添加一个 watch 的脚本，添加<code>--watch的标识</code>；</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --watch&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当你有<code>--watch标识</code>时会交给webpack-cli处理，webpack-cli会将<code>--watch标识</code>转换为配置<strong>watch: true</strong>。</p> <h3 id="webpack-dev-server"><a href="#webpack-dev-server" class="header-anchor">#</a> webpack-dev-server</h3> <p>webpack的watch模式虽说可以监听到文件的变化，但事实上它本身并没有自动刷新浏览器的功能。虽说可以在<strong>VSCode中使用live-server插件</strong>来完成这一功能，但是我们希望不使用live-server插件的情况下，可以具备<code>live reloading（实时重新加载）</code>的功能。</p> <p>可以使用webpack-dev-server，下面进行安装：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install webpack-dev-server -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在package.json文件的 scripts 中新添加一个 serve 的脚本，之后执行命令webpack-cli会找到 webpack-dev-server 来帮助我们开启一个本地服务器。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>配置后，在命令行执行 npm run serve 指令，我们打包的项目现在已经运行到localhost:8080端口，我们可访问此地址。</p> <img src="/frontend/frame/vue3/05_learn-webpack/28_webpack-env-server.png" alt="webpack-env-server" class="medium"> <p>原理是：webpack-dev-server是基于express框架搭建的本地服务器，当访问http://localhost:8080/时，会到框架搭建的服务器中找到打包的静态资源，之后将静态资源返回到浏览器，并做出展示。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>当使用webpack-dev-server时，我们发现dist文件夹内并没有打包后的文件，这是因为webpack-dev-server在编译之后不会写入任何输出文件，而是将打包后的bundle文件保存在内存中。</p> <p>这样做的好处是：当用户访问时，减少了将文件读取到内存的这个过程，提高了开发效率。</p> <p>事实上，webpack-dev-server使用了一个memfs这个库（memory-fs），这是用于保存内存中文件系统的库。</p></div> <p>下面讲解对webpack-dev-server进行一些配置选项：</p> <ol><li>contentBase</li></ol> <p>我们修改配置文件，告知 dev server，从什么位置查找文件。contentBase是指不由 webpack 打包生成的静态资源的根目录，默认为基础路径。我们加载public目录下的favicon.ico（注意：不使用copy-webpack-plugin插件）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> <span class="token string">&quot;./public&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>contentBase详细解析：</p> <p>源代码通过devServer打包的静态资源放到memfs的内存里面，之后会开启一个express服务器。当浏览器通过localhost:8080访问服务器，浏览器会下载服务器对应资源，一开始只会下载index.html文件，我们知道index.html中肯定还有其他资源，比如img、css、script，之后就会加载这些资源。就要从内存中打包的静态资源中查找，如果在内存中的静态资源加载不到，express框架通过devserver配置的contentBase定义的文件夹中去查找，找到加载到express框架的内存中，之后下载到浏览器就能加载资源。</p> <img src="/frontend/frame/vue3/05_learn-webpack/30_devServer的contentBase的理解.png" alt="devServer的contentBase的理解" class="medium"> <p>那contentBase和copy-webpack-plugin插件都是什么时候用：</p> <ul><li>在开发阶段为了对源代码编译的过程性能问题做考虑建议使用contentBase，</li> <li>而部署阶段的时候，要使用copy-webpack-plugin插件将public中的资源进行拷贝到dist文件夹 ，之后将所有资源进行打包部署到服务器。</li></ul> <p>总结一句话：就是资源加载的过程要去哪加载资源。</p> <p>如果遇到下面的报错信息，是webpack-dev-server安装版本太高，需要手动指定版本，当前版本为3.11.2。</p> <img src="/frontend/frame/vue3/05_learn-webpack/29_配置文件devServer.contentBase报错.png" alt="配置文件devServer.contentBase报错" class="medium"> <ol start="2"><li>模块热替换(HMR)</li></ol> <p>HMR的全称是Hot Module Replacement，翻译过来是模块热替换。模块热替换是指在应用程序运行过程中，<strong>添加、替换、删除模块，无需重新刷新整个页面</strong>。</p> <p>使用HMR的好处：</p> <ul><li>不需要重新加载全部内容，只更新需要变化的内容的模块，提高了开发效率；</li> <li>不需要重新加载整个页面，可以保留应用程序中状态不丢失；</li> <li>当修改了css、js源代码，会立即在浏览器更新，相当于直接在浏览器中修改；</li></ul> <p>默认情况下，webpack-dev-server已经支持HMR，只需开启即可。如果不开启HMR的情况下，如果修改了源代码，会整个页面自动刷新，使用的是刷新浏览器（live reloading）。</p> <p>开启HMR，第一步需修改webpack配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第二步要指定哪些模块发生更新时进行HMR，没有指定的模块在内容发生变化时还是刷新浏览器更新。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">&quot;./js/element&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;更新完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>开启HMR，浏览器控制台的效果：</p> <img src="/frontend/frame/vue3/05_learn-webpack/33_开启HMR的效果.png" alt="开启HMR的效果" class="medium"> <div class="custom-block danger"><p class="custom-block-title">注意</p> <p>由于 JavaScript 既可以编写服务端代码也可以编写浏览器代码，所以 webpack 提供了多种部署 target。当 target 设置为 web，webpack 将在 web 环境编译打包代码。</p> <p>在webpack配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  target<span class="token operator">:</span> <span class="token string">&quot;web&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <p>HMR的原理是什么，如何做到只更新一个模块中的内容呢？</p> <p>其实webpack-dev-server会创建两个服务：提供静态资源的服务（express server）和Socket服务（net.Socket server）。</p> <p>源代码通过webpack编译打包成对应的资源（bundle.js），之后webpack-dev-server会开启一个express server（静态服务器）负责直接提供静态资源的服务（也就是打包之后的资源可以直接被浏览器请求和解析的），客户端通过发送http请求和服务器建立连接后，服务器做出响应也就是将请求的对应资源发送到客户端。</p> <p>而Socket Server即HMR开启的Socket Server，是一个socket的长连接，长连接的好处是：建立连接后，服务器可以直接发送文件到客户端。当服务器监听到对应的模块发生变化时，会生成.json（manifest文件这是描述文件）和.js文件（update chunk这是具体更新文件）这两个文件，通过socket长连接直接将这两个文件发送给客户端（浏览器），客户端拿到这两个文件后，通过HMR runtime机制加载这两个文件，并针对修改的模块进行更新。</p> <img src="/frontend/frame/vue3/05_learn-webpack/31_HMR的原理图.png" alt="HMR的原理图" class="medium"> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>http连接是短连接，客户端主动发起请求服务器做出响应；
socket是长链接，客户端和服务器建立联系可以实时的通信，</p></div> <p>当使用框架开发项目时，我们修改了组件，也希望可以进行热更新。事实上社区已对此问题有很成熟的解决方案：</p> <ul><li>Vue开发，使用vue-loader，此loader就支持vue组件的HMR，提供开箱即用的效果；</li> <li>React开发，有React Hot Loader，实时调整react组件（目前React官方已经弃用了，改成使用reactrefresh）；</li></ul> <ol start="3"><li>host配置</li></ol> <p>host用于设置主机地址，默认值为localhost，如果希望其他地方可以访问可以设置为 0.0.0.0，需在webpack配置中进行配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    host<span class="token operator">:</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>那么localhost 和 0.0.0.0 的区别：</p> <ul><li><p>localhost其实是域名，一般windows系统默认将localhost指向127.0.0.1，但是localhost并不等于127.0.0.1，localhost指向的IP地址是可以配置的。凡是以127开头的IP地址，都是回环地址（Loop back address）。通俗的讲，就是我们在主机上发送给127开头的IP地址的数据包会被发送的主机自己接收，根本传不出去，外部设备也无法通过回环地址访问到本机。正常的数据库包经过：应用层 - 传输层 - 网络层 - 数据链路层 - 物理层。而回环地址，是在网络层直接就被获取到了，是不会经过数据链路层和物理层的。</p></li> <li><p>0.0.0.0：监听IPV4上所有的地址，再根据端口找到不同的应用程序。比如我们监听 0.0.0.0时，在同一个网段下的主机中，通过ip地址是可以访问的。</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>当在命令行输入 npm run serve 指令后，可在命令行看到可访问http://0.0.0.0:8080，但打开浏览器说无法访问此网站。</p> <p>我们通过Win+R输入cmd打开命令行工具，输入ipconfig查看ip地址，比如我这里显示192.168.0.107，那在浏览器输入http://192.168.0.107:8080，这样在此局域网的设备都可访问了。</p> <p>其实这里设置host为0.0.0.0的目的是为了让别的主机可以访问到我的主机，而不是让在浏览器通过http://0.0.0.0:8080访问。</p></div> <p>查看<a href="cloud.tencent.com/developer/article/1643083">彻底搞明白webpack-dev-server 配置 host 0.0.0.0作用</a></p> <ol start="4"><li>port</li></ol> <p>设置指定监听的接口号，默认情况下是8080，我们修改为7777。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token string">&quot;7777&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="5"><li>open</li></ol> <p>告诉 dev-server 在服务器已经启动后自动打开浏览器。设置其为 true 以打开你的默认浏览器，默认值是 false。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="6"><li>compress</li></ol> <p>设置是否开启gzip compression，默认值是false，开启的好处是从服务器请求资源时下载速度快点。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><img src="/frontend/frame/vue3/05_learn-webpack/32_devServer的compress属性.png" alt="devServer的compress属性" class="medium"> <ol start="7"><li>Proxy</li></ol> <p>proxy是开发中非常常见的一个配置选项，它的目的是设置代理来解决跨域访问问题。</p> <p>比如api请求是http://localhost:8888/users，本地启动服务器是http://localhost:7777，这时候发送网络请求就会出现跨域问题。我们可以将请求先发送到一个代理服务器，代理服务器和API服务器是没有跨域问题的，这就解决了跨域问题。</p> <p>我们对api请求在 localhost:8888 上，可以使用proxy来启用代理：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;api&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8888&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>现在，对 <code>/api/users</code> 的请求会将请求代理到 http://localhost:8888/api/users。</p> <p>如果不希望传递 /api，则需要重写路径：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       target<span class="token operator">:</span> <span class="token string">&quot;http://localhost:8888&quot;</span><span class="token punctuation">,</span>
       pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'/^api'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>默认情况下，将不接受在HTTPS上运行且证书无效的后端服务器。如果需要，可以将<code>secure</code>设置为<code>false</code>，默认为true表示不接受：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       target<span class="token operator">:</span> <span class="token string">&quot;http://localhost:8888&quot;</span><span class="token punctuation">,</span>
       pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'/^api'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
       secure<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>默认情况下，代理时会保留主机头的来源，可以将 changeOrigin 设置为 true 以覆盖此行为。什么意思呢？</p> <p>本地启动服务器是http://localhost:7777，后端api请求是http://localhost:8888。那么后端通过 request.getHeader(&quot;Host&quot;) 获取依旧是 http://localhost:7777。</p> <p>如果你设置了 <strong>changeOrigin: true</strong>，那么后端通过 request.getHeader(&quot;Host&quot;) 获取才是 http://localhost:8888。代理服务器此时会根据请求的 target 地址修改 Host。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       target<span class="token operator">:</span> <span class="token string">&quot;http://localhost:8888&quot;</span><span class="token punctuation">,</span>
       pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'/^api'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
       secure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
       changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="8"><li>historyApiFallback</li></ol> <p>historyApiFallback是开发中非常常见的属性，主要作用是解决SPA页面在路由跳转之后，进行页面刷新时，返回404的错误。</p> <p>其值可以是布尔值也可以是对象：</p> <ul><li>当为布尔值时，默认值为false。如果设置为true，那么在刷新时，返回404错误时会自动返回index.html的内容；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    historyApiFallback<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>当为对象时，可以配置rewrites属性，可以配置from来匹配路径，决定要跳转到哪个页面。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    historyApiFallback<span class="token operator">:</span> <span class="token punctuation">{</span>
      rewrites<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> to<span class="token operator">:</span> <span class="token string">'/views/landing.html'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/subpage</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> to<span class="token operator">:</span> <span class="token string">'/views/subpage.html'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> to<span class="token operator">:</span> <span class="token string">'/views/404.html'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>事实上devServer中实现historyApiFallback功能是通过connect-history-api-fallback库的：可以查看【<a href="https://github.com/bripkens/connect-history-api-fallback" target="_blank" rel="noopener noreferrer">connect-history-api-fallback<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档。</p> <h2 id="resolve模块解析"><a href="#resolve模块解析" class="header-anchor">#</a> resolve模块解析</h2> <p>在开发中有各种各样的模块依赖，这些模块中有些是自己编写的代码，有些是来自是第三方库。resolve可以帮助webpack从每个require/import语句中，找到需要引入到合适的模块代码。</p> <p>webpack 使用 enhanced-resolve 来解析文件路径。其能解析三种文件路径：</p> <ul><li>绝对路径
因为已经获取到文件的绝对路径，所以不需要再做进一步解析；</li> <li>相对路径
这种情况下，使用require/import导入的资源文件所处目录，被认为是上下文目录。根据require/import中给定的相对路径，会拼接上下文路径，结合来生成模块的绝对路径；</li> <li>模块路径
在resolve.modules中指定的所有目录检索模块，默认值是['node_modules']，所以默认从node_modules中查找文件。</li></ul> <p>我们可以通过alias配置来设置别名的方式来替换初始模块路径。比如@将代替之前的./src，js将代替之前的./src/js。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;@&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">&quot;js&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src/js&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如何确定是文件还是文件夹？</p> <p>如果文件具有后缀名，则直接加载文件，否则将使用resolve.extensions中选项来尝试按顺序解析文件的后缀名。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">&quot;.vue&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果是一个文件夹，会在文件夹中根据resolve.mainFiles配置选项中指定的文件顺序查找。其默认值是['index']，再根据resolve.extensions来解析后缀名。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    mainFiles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="webpack配置区分开发环境和生产环境"><a href="#webpack配置区分开发环境和生产环境" class="header-anchor">#</a> webpack配置区分开发环境和生产环境</h2> <p>目前我们所有的webpack配置信息都是放到一个配置文件中的：webpack.config.js。当配置越来越多这个文件变得越来越不好维护。并且某些配置是开发环境需要使用，有些配置是生产环境需要使用，还有开发环境和生产环境都需要的配置。所以需要对配置进行划分。</p> <p>在根目录下新建config文件夹，创建三个文件：</p> <ul><li>webpack.dev.config.js(开发环境需要的配置)</li> <li>webpack.prod.config.js(生产环境需要的配置)</li> <li>webpack.comm.config.js(开发环境和生产环境都需要的配置)</li></ul> <p>当启动时也要区分不同的配置，在package.json中修改build和serve脚本：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./config/webpack.prod.config.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve --config ./config/webpack.dev.config.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>当代码分离后，开发环境和生产环境都需要的公共代码进行整合，使用webpack-merge进行合并，需要安装：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install webpack-merge -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下面是具体的分离代码：</p> <ol><li>webpack.dev.config.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.comm.config&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 导出配置文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  devtool<span class="token operator">:</span> <span class="token string">&quot;source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// watch: true,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> <span class="token string">&quot;./public&quot;</span><span class="token punctuation">,</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    host<span class="token operator">:</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token string">&quot;7777&quot;</span><span class="token punctuation">,</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// proxy: {</span>
    <span class="token comment">//   &quot;api&quot;: {</span>
    <span class="token comment">//    target: &quot;http://localhost:8888&quot;,</span>
    <span class="token comment">//    pathRewrite: {'/^api', {}},</span>
    <span class="token comment">//    secure: false,</span>
    <span class="token comment">//    changeOrigin: true</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ol start="2"><li>webpack.prod.config.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CopyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;copy-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> commonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.comm.config&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 导出配置文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>commonConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CopyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      patterns<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span> 
          to<span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>
          globOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
            ignore<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/index.html&quot;</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ol start="3"><li>webpack.comm.config.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> DefinePlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> VueLoaderPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vue-loader/dist/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 导出配置文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  target<span class="token operator">:</span> <span class="token string">&quot;web&quot;</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;js/bundle.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;@&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">&quot;js&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src/js&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">&quot;.vue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    mainFiles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&quot;asset&quot;</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">&quot;img/[name]_[hash:6][ext]&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        parser<span class="token operator">:</span> <span class="token punctuation">{</span>
          dataUrlCondition<span class="token operator">:</span> <span class="token punctuation">{</span>
            maxSize<span class="token operator">:</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|woff2?)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&quot;asset/resource&quot;</span><span class="token punctuation">,</span>
        generator<span class="token operator">:</span> <span class="token punctuation">{</span>
          filename<span class="token operator">:</span> <span class="token string">&quot;font/[name]_[hash:6][ext]&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.m?js$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;vue-loader&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;webpack资源案例&quot;</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">&quot;./public/index.html&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token constant">BASE_URL</span><span class="token operator">:</span> <span class="token string">&quot;'./'&quot;</span><span class="token punctuation">,</span>
      __VUE_OPTIONS_API__<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      __VUE_PROD_DEVTOOLS__<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">VueLoaderPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>之前编写入口文件的规则是：./src/index.js，但是现在我们的配置文件所在位置变成config目录，我们是否应该变成 ../src/index.js呢？</p> <p>如果修改会发现报错了，这是因为入口文件其实是和context属性有关的。context的作用是：用于解析入口（entry point）和加载器（loader），官方说法：默认是当前路径（但是经过我测试，默认应该是webpack的启动目录）。</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2021-12-04  15:08:54</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/frontend/frame/vue3/04_组件化开发模式.html" class="prev">
        组件化开发模式
      </a></span> <span class="next"><a href="/pages/frontend/frame/vue3/06_Vue-CLI.html">
        Vue-CLI
      </a>
      →
    </span></p></div>  <!----></main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.2b276f17.js" defer></script><script src="/assets/js/6.4619fce8.js" defer></script><script src="/assets/js/2.ea162f4d.js" defer></script><script src="/assets/js/35.422344af.js" defer></script>
  </body>
</html>
